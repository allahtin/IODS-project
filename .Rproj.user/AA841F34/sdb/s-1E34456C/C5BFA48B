{
    "collab_server" : "",
    "contents" : "# ANALYSIS part of the Exercise Set 3\n\n\\vspace{20pt}\n\n##*1&2. Reading the joined student alcohol consumption data into R and exploring it*\n```{r}\nlibrary(dplyr)\njoined_data<-read.table(\"Joined student alcohol consumption data.txt\", header=T)\ndim(joined_data)\nglimpse(joined_data)\n```\nThe dataset \"joined_data\"\" includes info on student achievement in secondary education of two Portuguese schools. The data variables (35) include student grades, demographic, social and school related features) and it was collected by using school reports and questionnaires. Two datasets are provided regarding the performance in two distinct subjects: Mathematics (mat) and Portuguese language (por).\n\n##*3. Choosing variables and study hypotheses.*\n\nThe purpose of my analysis is to study the relationships between high/low alcohol consumption and some of the other variables in the data. To do this, I choose the following 4  variables:\n1. sex (hypothesis is that boys in average consume more alcohol an would be more often high-users), 2. age (older students would be consuming more and more of older ones would be found in high-users' group), 3. internet (those who have internet would be high-users or consume more) and 4.absences (the idea is that the more absences would be associated with high-users.\n\n##*4. The distrubutions of the chosen variables and what about my study hypotheses?*\n```{r}\njoined_data %>% group_by(sex) %>% summarise(count = n())\njoined_data %>% group_by(age) %>% summarise(count = n())\njoined_data %>% group_by(internet) %>% summarise(count = n())\njoined_data %>% group_by(absences) %>% summarise(count = n())\n```\n```{r}\nlibrary(ggplot2)\ng1 <- ggplot(joined_data, aes(x = high_use, y = age))\ng1 + geom_boxplot() + ylab(\"age\")\n```\n\nThe hypothesis about age looks like correct one: high-users are older in average.\n\n```{r}\nlibrary(ggplot2)\ng1 <- ggplot(joined_data, aes(high_use))\ng1 + geom_bar(aes(fill=sex)) \n```\n\nHypothesis about sex seems to be correct, too: in the high-users group there seems to be more boys than girls.\n\n```{r}\nlibrary(ggplot2)\ng1 <- ggplot(joined_data, aes(high_use))\ng1 + geom_bar(aes(fill=internet)) \n```\n\nHere it is not so obvious: it looks like in the high-users there are more of those who have internet, but this relationship is no so obvious and requires testing.\n\n```{r}\nlibrary(ggplot2)\ng1 <- ggplot(joined_data, aes(x = high_use, y = absences))\ng1 + geom_boxplot() + ylab(\"absences\")\n```\n\nIn case of absences we need to do calculations: it is not anymore obvious, though it seems that higher number of absences are indeed observed in the group of high-users.\n\n##*5. Logistic regression*\n\nFour variables are: sex, age, internet, absences.\n\n```{r}\nm <- glm(high_use ~ age + sex + internet + absences, data = joined_data, family = \"binomial\")\nsummary(m)\ncoef(m)\n```\n\nSummary of glm: Overall model is nicely fitted with significant P value (0.00618). However we can see that effect size is biggest for sex (0.98 is the estimate for boys). Next one is age, which is logical, as perhaps in case of alcohol consumption, getting older might make it easier to get alcohol somehow.Though P value is greater than 0.05 (0.08333).  Absences are at third place and they show significat association with high-users of alcohol. Internet seems to affect the least and is not significantly associated with being a high-user.The same was seen in the box plots and bars I made at the previous step. \n\nNow I will compute coefficients of the model as odds ratios and provide confidence intervals for them.\n\n```{r}\nOR <- coef(m) %>% exp\nCI <- confint(m) %>% exp\ncbind(OR, CI)\n```\n\n##*6. Binary prediction*\n\n```{r}\nlibrary(dplyr)\nm <- glm(high_use ~ age + sex + internet + absences, data = joined_data, family = \"binomial\")\nprobabilities <- predict(m, type = \"response\")\njoined_data <- mutate(joined_data, probability = probabilities)\njoined_data <- mutate(joined_data, prediction = probability > 0.5)\nselect(joined_data, age, internet, absences, sex, high_use, probability, prediction) %>% tail(10)\ntable(high_use = joined_data$high_use, prediction = joined_data$prediction)\n```\n\nComment: My prediction managed to predict 30 true high-users and 8 of them it predicted wrongly. For the oppositem 260 were predicted correctly and 84 not. Let's see how it looks like on plots. Looks like qiote a large error to me.\n\n```{r}\nlibrary(dplyr)\nlibrary(ggplot2)\ng <- ggplot(joined_data, aes(x = probability, y = high_use, col = prediction))\ng + geom_point()\ntable(high_use = joined_data$high_use, prediction = joined_data$prediction) %>% prop.table %>% addmargins\n```\n\nNow I calculate the trainng error or average number of wrong predictions in the training data.\n\n```{r}\nloss_func <- function(class, prob) {\n  n_wrong <- abs(class - prob) > 0.5\n  mean(n_wrong)\n}\nloss_func(class = joined_data$high_use, prob = 0)\n\n```\n\nSo the average number of wrong predictions is higher than we had in DataCamp example (it was 0.26 there). My model is not as good as the one in the example.According to own experience it is quite a large error, so model does not work too well,  based on these 4 variables. Maybe internet and \n\n##*Bonus*\n\nI will do K-fold cross-validation, as shown in the example with K=10.\n\n```{r}\nlibrary(boot)\ncv <- cv.glm(data = joined_data, cost = loss_func, glmfit = m, K = 10)\ncv$delta[1]\n```\n\nThe average number of wrong predictions in the cross validation is 0.2549267 which is a lower that in my model (see the one above). So 10-cross validation gives a lower error than my model.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1542484500992.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "211139294",
    "id" : "C5BFA48B",
    "lastKnownWriteTime" : 1542557846,
    "last_content_update" : -2147483648,
    "path" : "~/GitHub/IODS-project/chapter3.Rmd",
    "project_path" : "chapter3.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}